<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>Mongoose v8.5.2: SchemaType</title><link rel="apple-touch-icon" sizes="57x57" href="/docs/images/favicon/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/docs/images/favicon/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/docs/images/favicon/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/docs/images/favicon/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/docs/images/favicon/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/docs/images/favicon/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/docs/images/favicon/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/docs/images/favicon/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/docs/images/favicon/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/docs/images/favicon/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/docs/images/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/docs/images/favicon/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/docs/images/favicon/favicon-16x16.png"><link rel="manifest" href="/docs/images/favicon/manifest.json"><link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans"><link rel="stylesheet" href="/docs/css/github.css"><link rel="stylesheet" href="/docs/css/mongoose5.css"><link rel="stylesheet" href="/docs/css/carbonads.css"><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/docs/images/favicon/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="stylesheet" href="/docs/css/api.css"><script src="/docs/js/api-bold-current-nav.js"></script><script src="/docs/js/convert-old-anchorid.js"></script><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"></head><body><div id="layout"><div id="mobile-menu"><a class="menu-link" id="menuLink" href="#menu"><svg width="100%" height="100%" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></a><div id="mobile-logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div></div><div id="menu"><nav class="pure-menu"><div class="pure-menu-heading" id="logo-container"><a href="/"><img id="logo" src="/docs/images/mongoose5_62x30_transparent.png"><span class="logo-text">mongoose</span></a></div><ul class="pure-menu-list" id="navbar"><li class="pure-menu-horizontal pure-menu-item pure-menu-has-children pure-menu-allow-hover version"><a class="pure-menu-link" href="/docs/index.html">Version 8.5.2</a><ul class="pure-menu-children"><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/7.x/index.html">Version 7.8.0</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/6.x/index.html">Version 6.13.0</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/5.x/index.html">Version 5.13.22</a></li></ul></li><li class="pure-menu-item search"><input id="search-input-nav" type="text" placeholder="Search"><button id="search-button-nav"><img src="/docs/images/search.svg"></button></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/index.html">Quick Start</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/guides.html">Guides</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/guide.html">Schemas</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/schematypes.html">SchemaTypes</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/connections.html">Connections</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/models.html">Models</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/documents.html">Documents</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/subdocs.html">Subdocuments</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/queries.html">Queries</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/validation.html">Validation</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/middleware.html">Middleware</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/populate.html">Populate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/discriminators.html">Discriminators</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/plugins.html">Plugins</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/timestamps.html">Timestamps</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/transactions.html">Transactions</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/typescript.html">TypeScript</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">API</a><ul class="pure-menu-list"><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/mongoose.html">Mongoose</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/schema.html">Schema</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/connection.html">Connection</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/document.html">Document</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/model.html">Model</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/query.html">Query</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/aggregate.html">Aggregate</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link selected" href="/docs/api/schematype.html">SchemaType</a></li><li class="pure-menu-item sub-item"><a class="pure-menu-link" href="/docs/api/virtualtype.html">VirtualType</a></li></ul></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/migrating_to_8.html">Migration Guide</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/compatibility.html">Version Compatibility</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/version-support.html">Version Support</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/faq.html">FAQ</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/further_reading.html">Further Reading</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/enterprise.html">For Enterprise</a></li><li class="pure-menu-item"><a class="pure-menu-link" href="/docs/sponsors.html" >Sponsors</a></li></ul><div class="cpc-ad"><script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CKYIL27I&placement=mongoosejscom" id="_carbonads_js"></script></div></nav></div><div class="container"><div id="content"><a class="edit-docs-link" href="https://github.com/Automattic/mongoose/blob/master/lib/schemaType.js" target="_blank">
<img src="/docs/images/pencil.svg" />
</a><h1>SchemaType</h1><script type="text/javascript" src="//m.servedby-buysellads.com/monetization.custom.js"></script><link rel="stylesheet" href="/docs/css/inlinecpc.css"><div id="native-direct"></div><script>(function() {
if (typeof _bsa !== 'undefined' && _bsa) {
_bsa.init('custom', 'CK7DT53U', 'placement:mongoosejscom',
{
target: '#native-direct',
template: `
<div class="native-inline">
<a rel="sponsored noopener" target="_blank" href="##statlink##" title="##company## — ##tagline##"><span class="sponsor">Sponsor</span> ##company## — ##description##</a>
</div>
</a>
`
}
);
}
})();</script><div class="api-nav"><div class="api-nav-content"><div class="nav-item" id="nav-Mongoose"><div class="nav-item-title"><a href="mongoose.html">Mongoose</a></div></div><div class="nav-item" id="nav-Schema"><div class="nav-item-title"><a href="schema.html">Schema</a></div></div><div class="nav-item" id="nav-Connection"><div class="nav-item-title"><a href="connection.html">Connection</a></div></div><div class="nav-item" id="nav-Document"><div class="nav-item-title"><a href="document.html">Document</a></div></div><div class="nav-item" id="nav-Model"><div class="nav-item-title"><a href="model.html">Model</a></div></div><div class="nav-item" id="nav-Query"><div class="nav-item-title"><a href="query.html">Query</a></div></div><div class="nav-item" id="nav-QueryCursor"><div class="nav-item-title"><a href="querycursor.html">QueryCursor</a></div></div><div class="nav-item" id="nav-Aggregate"><div class="nav-item-title"><a href="aggregate.html">Aggregate</a></div></div><div class="nav-item" id="nav-AggregationCursor"><div class="nav-item-title"><a href="aggregationcursor.html">AggregationCursor</a></div></div><div class="nav-item" id="nav-SchemaType"><div class="nav-item-title" style="font-weight: bold"><a href="schematype.html">SchemaType</a></div><ul class="nav-item-sub"><li><a href="#SchemaType()"><code>SchemaType()</code></a></li><li><a href="#SchemaType.cast()"><code>SchemaType.cast()</code></a></li><li><a href="#SchemaType.checkRequired()"><code>SchemaType.checkRequired()</code></a></li><li><a href="#SchemaType.get()"><code>SchemaType.get()</code></a></li><li><a href="#SchemaType.prototype.cast()"><code>SchemaType.prototype.cast()</code></a></li><li><a href="#SchemaType.prototype.castFunction()"><code>SchemaType.prototype.castFunction()</code></a></li><li><a href="#SchemaType.prototype.default()"><code>SchemaType.prototype.default()</code></a></li><li><a href="#SchemaType.prototype.doValidate()"><code>SchemaType.prototype.doValidate()</code></a></li><li><a href="#SchemaType.prototype.get()"><code>SchemaType.prototype.get()</code></a></li><li><a href="#SchemaType.prototype.immutable()"><code>SchemaType.prototype.immutable()</code></a></li><li><a href="#SchemaType.prototype.index()"><code>SchemaType.prototype.index()</code></a></li><li><a href="#SchemaType.prototype.isRequired"><code>SchemaType.prototype.isRequired</code></a></li><li><a href="#SchemaType.prototype.path"><code>SchemaType.prototype.path</code></a></li><li><a href="#SchemaType.prototype.ref()"><code>SchemaType.prototype.ref()</code></a></li><li><a href="#SchemaType.prototype.required()"><code>SchemaType.prototype.required()</code></a></li><li><a href="#SchemaType.prototype.select()"><code>SchemaType.prototype.select()</code></a></li><li><a href="#SchemaType.prototype.set()"><code>SchemaType.prototype.set()</code></a></li><li><a href="#SchemaType.prototype.sparse()"><code>SchemaType.prototype.sparse()</code></a></li><li><a href="#SchemaType.prototype.text()"><code>SchemaType.prototype.text()</code></a></li><li><a href="#SchemaType.prototype.transform()"><code>SchemaType.prototype.transform()</code></a></li><li><a href="#SchemaType.prototype.unique()"><code>SchemaType.prototype.unique()</code></a></li><li><a href="#SchemaType.prototype.validate()"><code>SchemaType.prototype.validate()</code></a></li><li><a href="#SchemaType.prototype.validateAll()"><code>SchemaType.prototype.validateAll()</code></a></li><li><a href="#SchemaType.prototype.validators"><code>SchemaType.prototype.validators</code></a></li><li><a href="#SchemaType.set()"><code>SchemaType.set()</code></a></li></ul></div><div class="nav-item" id="nav-VirtualType"><div class="nav-item-title"><a href="virtualtype.html">VirtualType</a></div></div><div class="nav-item" id="nav-Error"><div class="nav-item-title"><a href="error.html">Error</a></div></div><div class="nav-item" id="nav-SchemaArray"><div class="nav-item-title"><a href="schemaarray.html">SchemaArray</a></div></div><div class="nav-item" id="nav-SchemaDocumentArray"><div class="nav-item-title"><a href="schemadocumentarray.html">SchemaDocumentArray</a></div></div><div class="nav-item" id="nav-SchemaSubdocument"><div class="nav-item-title"><a href="schemasubdocument.html">SchemaSubdocument</a></div></div><div class="nav-item" id="nav-SchemaBoolean"><div class="nav-item-title"><a href="schemaboolean.html">SchemaBoolean</a></div></div><div class="nav-item" id="nav-SchemaBuffer"><div class="nav-item-title"><a href="schemabuffer.html">SchemaBuffer</a></div></div><div class="nav-item" id="nav-SchemaNumber"><div class="nav-item-title"><a href="schemanumber.html">SchemaNumber</a></div></div><div class="nav-item" id="nav-SchemaObjectId"><div class="nav-item-title"><a href="schemaobjectid.html">SchemaObjectId</a></div></div><div class="nav-item" id="nav-SchemaString"><div class="nav-item-title"><a href="schemastring.html">SchemaString</a></div></div><div class="nav-item" id="nav-DocumentArray"><div class="nav-item-title"><a href="documentarray.html">DocumentArray</a></div></div><div class="nav-item" id="nav-Subdocument"><div class="nav-item-title"><a href="subdocument.html">Subdocument</a></div></div><div class="nav-item" id="nav-ArraySubdocument"><div class="nav-item-title"><a href="arraysubdocument.html">ArraySubdocument</a></div></div><div class="nav-item" id="nav-Buffer"><div class="nav-item-title"><a href="buffer.html">Buffer</a></div></div><div class="nav-item" id="nav-Decimal128"><div class="nav-item-title"><a href="decimal128.html">Decimal128</a></div></div><div class="nav-item" id="nav-Map"><div class="nav-item-title"><a href="map.html">Map</a></div></div><div class="nav-item" id="nav-Array"><div class="nav-item-title"><a href="array.html">Array</a></div></div></div></div><div class="api-content"><ul><li><a href="#SchemaType()"><code>SchemaType()</code></a></li><li><a href="#SchemaType.cast()"><code>SchemaType.cast()</code></a></li><li><a href="#SchemaType.checkRequired()"><code>SchemaType.checkRequired()</code></a></li><li><a href="#SchemaType.get()"><code>SchemaType.get()</code></a></li><li><a href="#SchemaType.prototype.cast()"><code>SchemaType.prototype.cast()</code></a></li><li><a href="#SchemaType.prototype.castFunction()"><code>SchemaType.prototype.castFunction()</code></a></li><li><a href="#SchemaType.prototype.default()"><code>SchemaType.prototype.default()</code></a></li><li><a href="#SchemaType.prototype.doValidate()"><code>SchemaType.prototype.doValidate()</code></a></li><li><a href="#SchemaType.prototype.get()"><code>SchemaType.prototype.get()</code></a></li><li><a href="#SchemaType.prototype.immutable()"><code>SchemaType.prototype.immutable()</code></a></li><li><a href="#SchemaType.prototype.index()"><code>SchemaType.prototype.index()</code></a></li><li><a href="#SchemaType.prototype.isRequired"><code>SchemaType.prototype.isRequired</code></a></li><li><a href="#SchemaType.prototype.path"><code>SchemaType.prototype.path</code></a></li><li><a href="#SchemaType.prototype.ref()"><code>SchemaType.prototype.ref()</code></a></li><li><a href="#SchemaType.prototype.required()"><code>SchemaType.prototype.required()</code></a></li><li><a href="#SchemaType.prototype.select()"><code>SchemaType.prototype.select()</code></a></li><li><a href="#SchemaType.prototype.set()"><code>SchemaType.prototype.set()</code></a></li><li><a href="#SchemaType.prototype.sparse()"><code>SchemaType.prototype.sparse()</code></a></li><li><a href="#SchemaType.prototype.text()"><code>SchemaType.prototype.text()</code></a></li><li><a href="#SchemaType.prototype.transform()"><code>SchemaType.prototype.transform()</code></a></li><li><a href="#SchemaType.prototype.unique()"><code>SchemaType.prototype.unique()</code></a></li><li><a href="#SchemaType.prototype.validate()"><code>SchemaType.prototype.validate()</code></a></li><li><a href="#SchemaType.prototype.validateAll()"><code>SchemaType.prototype.validateAll()</code></a></li><li><a href="#SchemaType.prototype.validators"><code>SchemaType.prototype.validators</code></a></li><li><a href="#SchemaType.set()"><code>SchemaType.set()</code></a></li></ul><hr class="separate-api-elements"><h3 id="SchemaType()"><a href="#SchemaType()"><code>SchemaType()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>path</code>
<span class="method-type">&laquo;String&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;SchemaTypeOptions&raquo;</span> See <a href="/docs/api/schematypeoptions.html">SchemaTypeOptions docs</a></p>
</li><li class="param"><code>[instance]</code>
<span class="method-type">&laquo;String&raquo;</span> </li></ul><div><p>SchemaType constructor. Do <strong>not</strong> instantiate <code>SchemaType</code> directly.
Mongoose converts your schema paths into SchemaTypes automatically.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({ name: String });
schema.path(&#39;name&#39;) instanceof SchemaType; // true
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.cast()"><a href="#SchemaType.cast()"><code>SchemaType.cast()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>caster</code>
<span class="method-type">&laquo;Function|false&raquo;</span> Function that casts arbitrary values to this type, or throws an error if casting failed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Get/set the function used to cast arbitrary values to this type.</p>
<h4 id="example">Example:</h4>
<pre><code>// Disallow `null` for numbers, and don&#39;t try to cast any values to
// numbers, so even strings like &#39;123&#39; will cause a CastError.
mongoose.Number.cast(function(v) {
  assert.ok(v === undefined || typeof v === &#39;number&#39;);
  return v;
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.checkRequired()"><a href="#SchemaType.checkRequired()"><code>SchemaType.checkRequired()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>[fn]</code>
<span class="method-type">&laquo;Function&raquo;</span> If set, will overwrite the current set function</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> The input <code>fn</code> or the already set function</li></ul><div><p>Set &amp; Get the <code>checkRequired</code> function
Override the function the required validator uses to check whether a value
passes the <code>required</code> check. Override this on the individual SchemaType.</p>
<h4 id="example">Example:</h4>
<pre><code>// Use this to allow empty strings to pass the `required` validator
mongoose.Schema.Types.String.checkRequired(v =&gt; typeof v === &#39;string&#39;);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.get()"><a href="#SchemaType.get()"><code>SchemaType.get()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>getter</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;this&raquo;</span> </li></ul><div><p>Attaches a getter for all instances of this schema type.</p>
<h4 id="example">Example:</h4>
<pre><code>// Make all numbers round down
mongoose.Number.get(function(v) { return Math.floor(v); });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.cast()"><a href="#SchemaType.prototype.cast()"><code>SchemaType.prototype.cast()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>value</code>
<span class="method-type">&laquo;Object&raquo;</span> value to cast</p>
</li><li class="param"><code>doc</code>
<span class="method-type">&laquo;Document&raquo;</span> document that triggers the casting</p>
</li><li class="param"><code>init</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><div><p>The function that Mongoose calls to cast arbitrary values to this SchemaType.</p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.castFunction()"><a href="#SchemaType.prototype.castFunction()"><code>SchemaType.prototype.castFunction()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>caster</code>
<span class="method-type">&laquo;Function|false&raquo;</span> Function that casts arbitrary values to this type, or throws an error if casting failed</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Function&raquo;</span> </li></ul><div><p>Get/set the function used to cast arbitrary values to this particular schematype instance.
Overrides <code>SchemaType.cast()</code>.</p>
<h4 id="example">Example:</h4>
<pre><code>// Disallow `null` for numbers, and don&#39;t try to cast any values to
// numbers, so even strings like &#39;123&#39; will cause a CastError.
const number = new mongoose.Number(&#39;mypath&#39;, {});
number.cast(function(v) {
  assert.ok(v === undefined || typeof v === &#39;number&#39;);
  return v;
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.default()"><a href="#SchemaType.prototype.default()"><code>SchemaType.prototype.default()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Function|any&raquo;</span> The default value to set</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any,undefined,void&raquo;</span> Returns the set default value.</li></ul><div><p>Sets a default value for this SchemaType.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({ n: { type: Number, default: 10 })
const M = db.model(&#39;M&#39;, schema)
const m = new M;
console.log(m.n) // 10
</code></pre>
<p>Defaults can be either <code>functions</code> which return the value to use as the default or the literal value itself. Either way, the value will be cast based on its schema type before being set during document creation.</p>
<h4 id="example-1">Example:</h4>
<pre><code>// values are cast:
const schema = new Schema({ aNumber: { type: Number, default: 4.815162342 }})
const M = db.model(&#39;M&#39;, schema)
const m = new M;
console.log(m.aNumber) // 4.815162342

// default unique objects for Mixed types:
const schema = new Schema({ mixed: Schema.Types.Mixed });
schema.path(&#39;mixed&#39;).default(function () {
  return {};
});

// if we don&#39;t use a function to return object literals for Mixed defaults,
// each document will receive a reference to the same object literal creating
// a &quot;shared&quot; object instance:
const schema = new Schema({ mixed: Schema.Types.Mixed });
schema.path(&#39;mixed&#39;).default({});
const M = db.model(&#39;M&#39;, schema);
const m1 = new M;
m1.mixed.added = 1;
console.log(m1.mixed); // { added: 1 }
const m2 = new M;
console.log(m2.mixed); // { added: 1 }
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.doValidate()"><a href="#SchemaType.prototype.doValidate()"><code>SchemaType.prototype.doValidate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>value</code>
<span class="method-type">&laquo;Any&raquo;</span> </li><li class="param"><code>callback</code>
<span class="method-type">&laquo;Function&raquo;</span> </li><li class="param"><code>scope</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><li class="param"><code>[options]</code>
<span class="method-type">&laquo;Object&raquo;</span> </li><ul style="margin-top: 0.5em"><li><code>[options.path]</code>
<span class="method-type">&laquo;String&raquo;</span> </li></ul></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;Any&raquo;</span> If no validators, returns the output from calling <code>fn</code>, otherwise no return</li></ul><div><p>Performs a validation of <code>value</code> using the validators declared for this SchemaType.</p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.get()"><a href="#SchemaType.prototype.get()"><code>SchemaType.prototype.get()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds a getter to this schematype.</p>
<h4 id="example">Example:</h4>
<pre><code>function dob (val) {
  if (!val) return val;
  return (val.getMonth() + 1) + &quot;/&quot; + val.getDate() + &quot;/&quot; + val.getFullYear();
}

// defining within the schema
const s = new Schema({ born: { type: Date, get: dob })

// or by retreiving its SchemaType
const s = new Schema({ born: Date })
s.path(&#39;born&#39;).get(dob)
</code></pre>
<p>Getters allow you to transform the representation of the data as it travels from the raw mongodb document to the value that you see.</p>
<p>Suppose you are storing credit card numbers and you want to hide everything except the last 4 digits to the mongoose user. You can do so by defining a getter in the following way:</p>
<pre><code>function obfuscate (cc) {
  return &#39;****-****-****-&#39; + cc.slice(cc.length-4, cc.length);
}

const AccountSchema = new Schema({
  creditCardNumber: { type: String, get: obfuscate }
});

const Account = db.model(&#39;Account&#39;, AccountSchema);

Account.findById(id, function (err, found) {
  console.log(found.creditCardNumber); // &#39;****-****-****-1234&#39;
});
</code></pre>
<p>Getters are also passed a second argument, the schematype on which the getter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<pre><code>function inspector (val, priorValue, schematype) {
  if (schematype.options.required) {
    return schematype.path + &#39; is required&#39;;
  } else {
    return schematype.path + &#39; is not&#39;;
  }
}

const VirusSchema = new Schema({
  name: { type: String, required: true, get: inspector },
  taxonomy: { type: String, get: inspector }
})

const Virus = db.model(&#39;Virus&#39;, VirusSchema);

Virus.findById(id, function (err, virus) {
  console.log(virus.name);     // name is required
  console.log(virus.taxonomy); // taxonomy is not
})
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.immutable()"><a href="#SchemaType.prototype.immutable()"><code>SchemaType.prototype.immutable()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/document.html#Document.prototype.isNew()">isNew</a></span></li></ul><div><p>Defines this path as immutable. Mongoose prevents you from changing
immutable paths unless the parent document has <a href="/docs/api/document.html#Document.prototype.isNew()"><code>isNew: true</code></a>.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({
  name: { type: String, immutable: true },
  age: Number
});
const Model = mongoose.model(&#39;Test&#39;, schema);

await Model.create({ name: &#39;test&#39; });
const doc = await Model.findOne();

doc.isNew; // false
doc.name = &#39;new name&#39;;
doc.name; // &#39;test&#39;, because `name` is immutable
</code></pre>
<p>Mongoose also prevents changing immutable properties using <code>updateOne()</code>
and <code>updateMany()</code> based on <a href="/docs/guide.html#strict">strict mode</a>.</p>
<h4 id="example-1">Example:</h4>
<pre><code>// Mongoose will strip out the `name` update, because `name` is immutable
Model.updateOne({}, { $set: { name: &#39;test2&#39; }, $inc: { age: 1 } });

// If `strict` is set to &#39;throw&#39;, Mongoose will throw an error if you
// update `name`
const err = await Model.updateOne({}, { name: &#39;test2&#39; }, { strict: &#39;throw&#39; }).
  then(() =&gt; null, err =&gt; err);
err.name; // StrictModeError

// If `strict` is `false`, Mongoose allows updating `name` even though
// the property is immutable.
Model.updateOne({}, { name: &#39;test2&#39; }, { strict: false });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.index()"><a href="#SchemaType.prototype.index()"><code>SchemaType.prototype.index()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>options</code>
<span class="method-type">&laquo;Object|Boolean|String|Number&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares the index options for this schematype.</p>
<h4 id="example">Example:</h4>
<pre><code>const s = new Schema({ name: { type: String, index: true })
const s = new Schema({ name: { type: String, index: -1 })
const s = new Schema({ loc: { type: [Number], index: &#39;hashed&#39; })
const s = new Schema({ loc: { type: [Number], index: &#39;2d&#39;, sparse: true })
const s = new Schema({ loc: { type: [Number], index: { type: &#39;2dsphere&#39;, sparse: true }})
const s = new Schema({ date: { type: Date, index: { unique: true, expires: &#39;1d&#39; }})
s.path(&#39;my.path&#39;).index(true);
s.path(&#39;my.date&#39;).index({ expires: 60 });
s.path(&#39;my.path&#39;).index({ unique: true, sparse: true });
</code></pre>
<h4 id="note">Note:</h4>
<p><em>Indexes are created <a href="https://www.mongodb.com/docs/manual/core/index-creation/#index-creation-background">in the background</a>
by default. If <code>background</code> is set to <code>false</code>, MongoDB will not execute any
read/write operations you send until the index build.
Specify <code>background: false</code> to override Mongoose&#39;s default.</em></p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.isRequired"><a href="#SchemaType.prototype.isRequired"><code>SchemaType.prototype.isRequired</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>True if this SchemaType has a required validator. False otherwise.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({ name: { type: String, required: true } });
schema.path(&#39;name&#39;).isRequired; // true

schema.path(&#39;name&#39;).required(false);
schema.path(&#39;name&#39;).isRequired; // false
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.path"><a href="#SchemaType.prototype.path"><code>SchemaType.prototype.path</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The path to this SchemaType in a Schema.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({ name: String });
schema.path(&#39;name&#39;).path; // &#39;name&#39;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.ref()"><a href="#SchemaType.prototype.ref()"><code>SchemaType.prototype.ref()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>ref</code>
<span class="method-type">&laquo;String|Model|Function&raquo;</span> either a model name, a <a href="/docs/models.html">Model</a>, or a function that returns a model name or model.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Set the model that this path refers to. This is the option that <a href="/docs/populate.html">populate</a>
looks at to determine the foreign collection it should query.</p>
<h4 id="example">Example:</h4>
<pre><code>const userSchema = new Schema({ name: String });
const User = mongoose.model(&#39;User&#39;, userSchema);

const postSchema = new Schema({ user: mongoose.ObjectId });
postSchema.path(&#39;user&#39;).ref(&#39;User&#39;); // Can set ref to a model name
postSchema.path(&#39;user&#39;).ref(User); // Or a model class
postSchema.path(&#39;user&#39;).ref(() =&gt; &#39;User&#39;); // Or a function that returns the model name
postSchema.path(&#39;user&#39;).ref(() =&gt; User); // Or a function that returns the model class

// Or you can just declare the `ref` inline in your schema
const postSchema2 = new Schema({
  user: { type: mongoose.ObjectId, ref: User }
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.required()"><a href="#SchemaType.prototype.required()"><code>SchemaType.prototype.required()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>required</code>
<span class="method-type">&laquo;Boolean|Function|Object&raquo;</span> enable/disable the validator, or function that returns required boolean, or options object</p>
</li><ul style="margin-top: 0.5em"><li><code>[options.isRequired]</code>
<span class="method-type">&laquo;Boolean|Function&raquo;</span> enable/disable the validator, or function that returns required boolean</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[options.ErrorConstructor]</code>
<span class="method-type">&laquo;Function&raquo;</span> custom error constructor. The constructor receives 1 parameter, an object containing the validator properties.</p>
</li></ul><li class="param"><code>[message]</code>
<span class="method-type">&laquo;String&raquo;</span> optional custom error message</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><h5>See:</h5><ul><li><span class="method-type"><a href="/docs/api/error.html#Error.messages">Customized Error Messages</a></span></li><li><span class="method-type"><a href="/docs/api/schemaarray.html#SchemaArray.prototype.checkRequired()">SchemaArray#checkRequired</a></span></li><li><span class="method-type"><a href="/docs/api/schemaboolean.html#SchemaBoolean.prototype.checkRequired()">SchemaBoolean#checkRequired</a></span></li><li><span class="method-type"><a href="/docs/api/schemabuffer.html#SchemaBuffer.prototype.checkRequired()">SchemaBuffer#checkRequired</a></span></li><li><span class="method-type"><a href="/docs/api/schemanumber.html#SchemaNumber.prototype.checkRequired()">SchemaNumber#checkRequired</a></span></li><li><span class="method-type"><a href="/docs/api/schemaobjectid.html#ObjectId.prototype.checkRequired()">SchemaObjectId#checkRequired</a></span></li><li><span class="method-type"><a href="/docs/api/schemastring.html#SchemaString.prototype.checkRequired()">SchemaString#checkRequired</a></span></li></ul><div><p>Adds a required validator to this SchemaType. The validator gets added
to the front of this SchemaType&#39;s validators array using <code>unshift()</code>.</p>
<h4 id="example">Example:</h4>
<pre><code>const s = new Schema({ born: { type: Date, required: true })

// or with custom error message

const s = new Schema({ born: { type: Date, required: &#39;{PATH} is required!&#39; })

// or with a function

const s = new Schema({
  userId: ObjectId,
  username: {
    type: String,
    required: function() { return this.userId != null; }
  }
})

// or with a function and a custom message
const s = new Schema({
  userId: ObjectId,
  username: {
    type: String,
    required: [
      function() { return this.userId != null; },
      &#39;username is required if id is specified&#39;
    ]
  }
})

// or through the path API

s.path(&#39;name&#39;).required(true);

// with custom error messaging

s.path(&#39;name&#39;).required(true, &#39;grrr :( &#39;);

// or make a path conditionally required based on a function
const isOver18 = function() { return this.age &gt;= 18; };
s.path(&#39;voterRegistrationId&#39;).required(isOver18);
</code></pre>
<p>The required validator uses the SchemaType&#39;s <code>checkRequired</code> function to
determine whether a given value satisfies the required validator. By default,
a value satisfies the required validator if <code>val != null</code> (that is, if
the value is not null nor undefined). However, most built-in mongoose schema
types override the default <code>checkRequired</code> function:</p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.select()"><a href="#SchemaType.prototype.select()"><code>SchemaType.prototype.select()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>val</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Sets default <code>select()</code> behavior for this path.</p>
<p>Set to <code>true</code> if this path should always be included in the results, <code>false</code> if it should be excluded by default. This setting can be overridden at the query level.</p>
<h4 id="example">Example:</h4>
<pre><code>T = db.model(&#39;T&#39;, new Schema({ x: { type: String, select: true }}));
T.find(..); // field x will always be selected ..
// .. unless overridden;
T.find().select(&#39;-x&#39;).exec(callback);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.set()"><a href="#SchemaType.prototype.set()"><code>SchemaType.prototype.set()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds a setter to this schematype.</p>
<h4 id="example">Example:</h4>
<pre><code>function capitalize (val) {
  if (typeof val !== &#39;string&#39;) val = &#39;&#39;;
  return val.charAt(0).toUpperCase() + val.substring(1);
}

// defining within the schema
const s = new Schema({ name: { type: String, set: capitalize }});

// or with the SchemaType
const s = new Schema({ name: String })
s.path(&#39;name&#39;).set(capitalize);
</code></pre>
<p>Setters allow you to transform the data before it gets to the raw mongodb
document or query.</p>
<p>Suppose you are implementing user registration for a website. Users provide
an email and password, which gets saved to mongodb. The email is a string
that you will want to normalize to lower case, in order to avoid one email
having more than one account -- e.g., otherwise, <a href="mailto:&#97;&#x76;&#x65;&#110;&#117;&#101;&#x40;&#113;&#46;&#99;&#111;&#x6d;">&#97;&#x76;&#x65;&#110;&#117;&#101;&#x40;&#113;&#46;&#99;&#111;&#x6d;</a> can be registered for 2 accounts via <a href="mailto:&#x61;&#x76;&#x65;&#110;&#117;&#x65;&#64;&#113;&#46;&#99;&#111;&#x6d;">&#x61;&#x76;&#x65;&#110;&#117;&#x65;&#64;&#113;&#46;&#99;&#111;&#x6d;</a> and <a href="mailto:&#x41;&#x76;&#x45;&#110;&#x55;&#x65;&#x40;&#81;&#x2e;&#67;&#111;&#77;">&#x41;&#x76;&#x45;&#110;&#x55;&#x65;&#x40;&#81;&#x2e;&#67;&#111;&#77;</a>.</p>
<p>You can set up email lower case normalization easily via a Mongoose setter.</p>
<pre><code>function toLower(v) {
  return v.toLowerCase();
}

const UserSchema = new Schema({
  email: { type: String, set: toLower }
});

const User = db.model(&#39;User&#39;, UserSchema);

const user = new User({email: &#39;AVENUE@Q.COM&#39;});
console.log(user.email); // &#39;avenue@q.com&#39;

// or
const user = new User();
user.email = &#39;Avenue@Q.com&#39;;
console.log(user.email); // &#39;avenue@q.com&#39;
User.updateOne({ _id: _id }, { $set: { email: &#39;AVENUE@Q.COM&#39; } }); // update to &#39;avenue@q.com&#39;
</code></pre>
<p>As you can see above, setters allow you to transform the data before it
stored in MongoDB, or before executing a query.</p>
<p><em>NOTE: we could have also just used the built-in <code>lowercase: true</code> SchemaType option instead of defining our own function.</em></p>
<pre><code>new Schema({ email: { type: String, lowercase: true }})
</code></pre>
<p>Setters are also passed a second argument, the schematype on which the setter was defined. This allows for tailored behavior based on options passed in the schema.</p>
<pre><code>function inspector (val, priorValue, schematype) {
  if (schematype.options.required) {
    return schematype.path + &#39; is required&#39;;
  } else {
    return val;
  }
}

const VirusSchema = new Schema({
  name: { type: String, required: true, set: inspector },
  taxonomy: { type: String, set: inspector }
})

const Virus = db.model(&#39;Virus&#39;, VirusSchema);
const v = new Virus({ name: &#39;Parvoviridae&#39;, taxonomy: &#39;Parvovirinae&#39; });

console.log(v.name);     // name is required
console.log(v.taxonomy); // Parvovirinae
</code></pre>
<p>You can also use setters to modify other properties on the document. If
you&#39;re setting a property <code>name</code> on a document, the setter will run with
<code>this</code> as the document. Be careful, in mongoose 5 setters will also run
when querying by <code>name</code> with <code>this</code> as the query.</p>
<pre><code>const nameSchema = new Schema({ name: String, keywords: [String] });
nameSchema.path(&#39;name&#39;).set(function(v) {
  // Need to check if `this` is a document, because in mongoose 5
  // setters will also run on queries, in which case `this` will be a
  // mongoose query object.
  if (this instanceof Document &amp;&amp; v != null) {
    this.keywords = v.split(&#39; &#39;);
  }
  return v;
});
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.sparse()"><a href="#SchemaType.prototype.sparse()"><code>SchemaType.prototype.sparse()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares a sparse index.</p>
<h4 id="example">Example:</h4>
<pre><code>const s = new Schema({ name: { type: String, sparse: true } });
s.path(&#39;name&#39;).index({ sparse: true });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.text()"><a href="#SchemaType.prototype.text()"><code>SchemaType.prototype.text()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares a full text index.</p>
<h3 id="example">Example:</h3>
<pre><code> const s = new Schema({ name : { type: String, text : true } })
 s.path(&#39;name&#39;).index({ text : true });
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.transform()"><a href="#SchemaType.prototype.transform()"><code>SchemaType.prototype.transform()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>fn</code>
<span class="method-type">&laquo;Function&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Defines a custom function for transforming this path when converting a document to JSON.</p>
<p>Mongoose calls this function with one parameter: the current <code>value</code> of the path. Mongoose
then uses the return value in the JSON output.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({
  date: { type: Date, transform: v =&gt; v.getFullYear() }
});
const Model = mongoose.model(&#39;Test&#39;, schema);

await Model.create({ date: new Date(&#39;2016-06-01&#39;) });
const doc = await Model.findOne();

doc.date instanceof Date; // true

doc.toJSON().date; // 2016 as a number
JSON.stringify(doc); // &#39;{&quot;_id&quot;:...,&quot;date&quot;:2016}&#39;
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.unique()"><a href="#SchemaType.prototype.unique()"><code>SchemaType.prototype.unique()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>bool</code>
<span class="method-type">&laquo;Boolean&raquo;</span> </li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Declares an unique index.</p>
<h4 id="example">Example:</h4>
<pre><code>const s = new Schema({ name: { type: String, unique: true } });
s.path(&#39;name&#39;).index({ unique: true });
</code></pre>
<p><em>NOTE: violating the constraint returns an <code>E11000</code> error from MongoDB when saving, not a Mongoose validation error.</em></p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.validate()"><a href="#SchemaType.prototype.validate()"><code>SchemaType.prototype.validate()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>obj</code>
<span class="method-type">&laquo;RegExp|Function|Object&raquo;</span> validator function, or hash describing options</p>
</li><ul style="margin-top: 0.5em"><li><code>[obj.validator]</code>
<span class="method-type">&laquo;Function&raquo;</span> validator function. If the validator function returns <code>undefined</code> or a truthy value, validation succeeds. If it returns <a href="https://masteringjs.io/tutorials/fundamentals/falsy">falsy</a> (except <code>undefined</code>) or throws an error, validation fails.</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[obj.message]</code>
<span class="method-type">&laquo;String|Function&raquo;</span> optional error message. If function, should return the error message as a string</p>
</li></ul><ul style="margin-top: 0.5em"><li><code>[obj.propsParameter=false]</code>
<span class="method-type">&laquo;Boolean&raquo;</span> If true, Mongoose will pass the validator properties object (with the <code>validator</code> function, <code>message</code>, etc.) as the 2nd arg to the validator function. This is disabled by default because many validators <a href="https://github.com/chriso/validator.js#validators">rely on positional args</a>, so turning this on may cause unpredictable behavior in external validators.</p>
</li></ul><li class="param"><code>[errorMsg]</code>
<span class="method-type">&laquo;String|Function&raquo;</span> optional error message. If function, should return the error message as a string</p>
</li><li class="param"><code>[type]</code>
<span class="method-type">&laquo;String&raquo;</span> optional validator type</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;SchemaType&raquo;</span> this</li></ul><div><p>Adds validator(s) for this document path.</p>
<p>Validators always receive the value to validate as their first argument and
must return <code>Boolean</code>. Returning <code>false</code> or throwing an error means
validation failed.</p>
<p>The error message argument is optional. If not passed, the <a href="/docs/api/error.html#Error.messages">default generic error message template</a> will be used.</p>
<h4 id="example">Example:</h4>
<pre><code>// make sure every value is equal to &quot;something&quot;
function validator (val) {
  return val === &#39;something&#39;;
}
new Schema({ name: { type: String, validate: validator }});

// with a custom error message

const custom = [validator, &#39;Uh oh, {PATH} does not equal &quot;something&quot;.&#39;]
new Schema({ name: { type: String, validate: custom }});

// adding many validators at a time

const many = [
    { validator: validator, message: &#39;uh oh&#39; }
  , { validator: anotherValidator, message: &#39;failed&#39; }
]
new Schema({ name: { type: String, validate: many }});

// or utilizing SchemaType methods directly:

const schema = new Schema({ name: &#39;string&#39; });
schema.path(&#39;name&#39;).validate(validator, &#39;validation of `{PATH}` failed with value `{VALUE}`&#39;);
</code></pre>
<h4 id="error-message-templates">Error message templates:</h4>
<p>Below is a list of supported template keywords:</p>
<ul>
<li>PATH: The schema path where the error is being triggered.</li>
<li>VALUE: The value assigned to the PATH that is triggering the error.</li>
<li>KIND: The validation property that triggered the error i.e. required.</li>
<li>REASON: The error object that caused this error if there was one.</li>
</ul>
<p>If Mongoose&#39;s built-in error message templating isn&#39;t enough, Mongoose
supports setting the <code>message</code> property to a function.</p>
<pre><code>schema.path(&#39;name&#39;).validate({
  validator: function(v) { return v.length &gt; 5; },
  // `errors[&#39;name&#39;]` will be &quot;name must have length 5, got &#39;foo&#39;&quot;
  message: function(props) {
    return `${props.path} must have length 5, got &#39;${props.value}&#39;`;
  }
});
</code></pre>
<p>To bypass Mongoose&#39;s error messages and just copy the error message that
the validator throws, do this:</p>
<pre><code>schema.path(&#39;name&#39;).validate({
  validator: function() { throw new Error(&#39;Oops!&#39;); },
  // `errors[&#39;name&#39;].message` will be &quot;Oops!&quot;
  message: function(props) { return props.reason.message; }
});
</code></pre>
<h4 id="asynchronous-validation">Asynchronous validation:</h4>
<p>Mongoose supports validators that return a promise. A validator that returns
a promise is called an <em>async validator</em>. Async validators run in
parallel, and <code>validate()</code> will wait until all async validators have settled.</p>
<pre><code>schema.path(&#39;name&#39;).validate({
  validator: function (value) {
    return new Promise(function (resolve, reject) {
      resolve(false); // validation failed
    });
  }
});
</code></pre>
<p>You might use asynchronous validators to retreive other documents from the database to validate against or to meet other I/O bound validation needs.</p>
<p>Validation occurs <code>pre(&#39;save&#39;)</code> or whenever you manually execute <a href="/docs/api/document.html#Document.prototype.validate()">document#validate</a>.</p>
<p>If validation fails during <code>pre(&#39;save&#39;)</code> and no callback was passed to receive the error, an <code>error</code> event will be emitted on your Models associated db <a href="/docs/api/connection.html#Connection()">connection</a>, passing the validation error object along.</p>
<pre><code>const conn = mongoose.createConnection(..);
conn.on(&#39;error&#39;, handleError);

const Product = conn.model(&#39;Product&#39;, yourSchema);
const dvd = new Product(..);
dvd.save(); // emits error on the `conn` above
</code></pre>
<p>If you want to handle these errors at the Model level, add an <code>error</code>
listener to your Model as shown below.</p>
<pre><code>// registering an error listener on the Model lets us handle errors more locally
Product.on(&#39;error&#39;, handleError);
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.validateAll()"><a href="#SchemaType.prototype.validateAll()"><code>SchemaType.prototype.validateAll()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>validators</code>
<span class="method-type">&laquo;Array&lt;RegExp|Function|Object&gt;&raquo;</span> </li></ul><div><p>Adds multiple validators for this document path.
Calls <code>validate()</code> for every element in validators.</p>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.prototype.validators"><a href="#SchemaType.prototype.validators"><code>SchemaType.prototype.validators</code></a></h3><h5>Type:</h5><ul><li><span class="method-type">&laquo;property&raquo;</span></li></ul><div><p>The validators that Mongoose should run to validate properties at this SchemaType&#39;s path.</p>
<h4 id="example">Example:</h4>
<pre><code>const schema = new Schema({ name: { type: String, required: true } });
schema.path(&#39;name&#39;).validators.length; // 1, the `required` validator
</code></pre>
  </div><hr class="separate-api-elements"><h3 id="SchemaType.set()"><a href="#SchemaType.set()"><code>SchemaType.set()</code></a></h3><h5>Parameters:</h5><ul class="params"><li class="param"><code>option</code>
<span class="method-type">&laquo;String&raquo;</span> The name of the option you&#39;d like to set (e.g. trim, lowercase, etc...)</p>
</li><li class="param"><code>value</code>
<span class="method-type">&laquo;Any&raquo;</span> The value of the option you&#39;d like to set.</p>
</li></ul><h5>Returns:</h5><ul><li><span class="method-type">&laquo;void,void&raquo;</span> </li></ul><div><p>Sets a default option for this schema type.</p>
<h4 id="example">Example:</h4>
<pre><code>// Make all strings be trimmed by default
mongoose.SchemaTypes.String.set(&#39;trim&#39;, true);
</code></pre>
  </div></div></div></div><div id="jobs"><div class="job-listing"><a href="/docs/jobs.html#61f0b0402d893554bc3a247f"><div class="company-logo"><img src="https://assets.localizecdn.com/uploads/1689251999716.png"></div><div class="description"><div class="company">Localize</div><div class="title">Full Stack Engineer</div><div class="location">Anywhere</div></div></a></div><div class="button jobs-view-more"><a href="/docs/jobs.html">View more jobs!</a></div></div><script type="text/javascript" src="/docs/js/navbar-search.js"></script><script type="text/javascript" src="/docs/js/mobile-navbar-toggle.js"></script></div></body></html>